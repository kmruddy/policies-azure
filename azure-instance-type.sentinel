import "tfplan-functions" as plan

allowed_sizes = ["Standard_A0", "Standard_A1"]

allAzureLinuxVMs = plan.find_resources("azurerm_linux_virtual_machine")

violatingAzureLinuxVMs = plan.filter_attribute_not_in_list(allAzureLinuxVMs, "size", allowed_sizes, true)

get_resources = func(type) {
		return get_resources_root_only(type)
}

violations = length(violatingAzureLinuxVMs["messages"])

main = rule {
  violations is 0
}
